#!/bin/bash
#SBATCH --partition=scavenger
#SBATCH --job-name=pv3
#SBATCH --account=scavenger
#SBATCH --requeue
#SBATCH --gpus-per-task={{gpus_per_task}}
#SBATCH --cpus-per-gpu=6
#SBATCH --time=6:0:0
#SBATCH --ntasks={{ntasks}}
#SBATCH --output=slurm/logs/%x_%j.out
#SBATCH --array={{array}}
#SBATCH --exclude=legacygpu01
{{nodes}}

#export PATH=$PATH:/admin/home-costa/.local/bin
unset LD_LIBRARY_PATH
module load cuda/11.4.4
nvcc --version

env_ids={{env_ids}}
seeds={{seeds}}
env_id=${env_ids[$SLURM_ARRAY_TASK_ID / {{len_seeds}}]}
seed=${seeds[$SLURM_ARRAY_TASK_ID % {{len_seeds}}]}

echo "Running task $SLURM_ARRAY_TASK_ID with env_id: $env_id and seed: $seed"

srun {{command}} --env-id $env_id --seed $seed
